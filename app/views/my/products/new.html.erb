<% title "List a Product" %>

<%= error_messages_for @product  %>
<%= semantic_form_for [:my,@product]  do |f| %>

  <%= render :partial => "form", :locals => {:f => f} %>  
  <%= f.buttons do %>
    <%= f.submit %>
    <%= f.cancel_link %> 
  <% end %>

<% end %>

<script type="text/javascript" charset="utf-8">
 <%- session_key = Rails.application.config.session_options[:key] -%> 
   $(document).ready(function() {

     $('#product_picture').click(function(event){ 
       event.preventDefault();
     }); 

     $('#picture').uploadify({
       uploader : '/uploadify/uploadify.swf',
       cancelImg : '/uploadify/cancel.png',
       multi : true,
       auto : true,
       script : '/uploads',
       onComplete : function(event, queueID, fileObj, response, data) { 
         var dat = eval('(' + response + ')');
         $.getScript(dat.upload);},
       scriptData : {
         '_http_accept': 'application/javascript',
         'format' : 'json',
         '_method': 'post',
         '<%= session_key %>' : encodeURIComponent('<%= u cookies[session_key] %>'),
         'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>'),
         'product_draft_id' : '<%= @product_draft.id %>'
       }
     });

     $("[id*='shipping_']").click(function(){
       var reg = /_custom/ ;
       var $this = $(this);
       var $td = $this.parents("tr").find("td").eq(-1);
       if(reg.exec($this.attr("id")) != null)
         $td.show();
       else
         $td.hide();
     }) 

   }); 
 
</script>
