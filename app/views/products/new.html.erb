<%= stylesheet_link_tag 'jquery.fancybox-1.3.4' %>
<%= javascript_include_tag "jquery.fancybox-1.3.4" %>

<% title "List a Product" %>

<%= semantic_form_for @product , :validate => true  do |f| %>
  <%= f.inputs do %>
    <%#= f.input :category_id ,  :as=>"select" ,  :collection=> Category.all , :required => true %>

    Category:<span id="show_category"></span><%= link_to "edit_category" , "javascript:;" , :id=>"edit_category"%>

    <div id="select_category">
    <%= select_tag "first_category" , options_from_collection_for_select(Category.all, "id", "name"), :multiple => true , :style=>'height:250px;' , :required=>true %>
    <%= select_tag "second_category" , options_from_collection_for_select(Category.all, "id", "name"), :multiple => true , :style=>'height:250px;' , :required=>true %>
    <%= select_tag "third_category" , options_from_collection_for_select(Category.all, "id", "name"), :multiple => true , :style=>'height:250px;' , :required=>true %>
    <%= select_tag "four_category" , options_from_collection_for_select(Category.all, "id", "name"), :multiple => true , :style=>'height:250px;' , :required=>true %>
    </div>
    <%= f.input :name , :required => true %>
    <%= f.input :description , :required => true %>

    <li class="string required">
      <label>Tags:</label>
      <%= text_field_tag :tags %> (split by ,)
    </li>
    <li>
      <%= f.input :picture , :as=> :file, :label => "Upload Images"%>
    </li>
    <div id="uploads"></div>     
  <% end %> 

  <%= f.buttons do %>
    <%= f.commit_button "Create" %>
    <%= f.cancel_link    %> 
  <% end %>

<% end %>

<script type="text/javascript" charset="utf-8">
<%- session_key = Rails.application.config.session_options[:key] -%> 
  $(document).ready(function() {
	
    $('#product_picture').click(function(event){ 
      event.preventDefault();
    }); 
	
    $('#product_picture').uploadify({
      uploader : '/uploadify/uploadify.swf',
      cancelImg : '/uploadify/cancel.png',
      multi : true,
      auto : true,
      script : '/uploads',
      onComplete : function(event, queueID, fileObj, response, data) { 
        var dat = eval('(' + response + ')');
        $.getScript(dat.upload);},
      scriptData : {
        '_http_accept': 'application/javascript',
        'format' : 'json',
        '_method': 'post',
        '<%= session_key %>' : encodeURIComponent('<%= u cookies[session_key] %>'),
        'authenticity_token': encodeURIComponent('<%= u form_authenticity_token %>'),
        'product_draft_id' : '<%= @product_draft.id %>'
      }
    });
	
    $('#product_submit').click(function(event){
      event.preventDefault(); 
      $('#product_picture').uploadifyUpload(); 
    });
    
    $("#edit_category").click(function(){
      $("#select_category").toggle();
    })
		
  }); 
</script>